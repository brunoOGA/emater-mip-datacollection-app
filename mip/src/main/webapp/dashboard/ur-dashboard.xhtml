<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/WEB-INF/templates/template.xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions"
                xmlns:hf="http://highfaces.org"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="metadata">
        <ui:param name="title" value="Painel de Controle da UR #{param.fieldName} (#{param.harvestName})"/> 
    </ui:define>

    <ui:define name="description">
    </ui:define>

    <ui:define name="body">
        <h:form>

            #{flash.putNow("aSurveyId", param['surveyId'])}

            <ui:include src="add-mip.xhtml"></ui:include>

            <p:growl showDetail="true" life="3000"></p:growl>

            <p:spacer height="15px"/>

            <div class="row" >                
                <div class="col-md-12">
                    <p:panel header="Manejo Integrado de Pragas" styleClass="box-primary" toggleable="true" closable="false">

                        <f:facet name="actions">
                            <a href="#" title="Adicionar anotação de campo" class="btn btn-primary fa fa-plus"  data-toggle="modal" data-target="#modal-default" ></a>
                        </f:facet>

                        <div class="col-md-4 col-sm-12">
                            <p:scrollPanel style="height:500px">

                                <p:spacer height="5px"/>

                                <ul class="timeline">

                                    <p:repeat value="#{urDashboardController.MIPSampleData}" var="aSample">
                                        <li class="time-label">
                                            <span class="bg-blue">
                                                <h:outputText title="Data da amostra" value="#{aSample.sampleDate}" >
                                                    <f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
                                                </h:outputText>
                                            </span>
                                        </li>

                                        <li>
                                            <i class="fa fa-fw bg-gray">
                                                <h:outputText title="Dias após emergência" value="#{aSample.DAE}" styleClass="bg-gray" />
                                            </i>
                                            <div class="timeline-item">


                                                <div class="time">
                                                    <i class="fa fa-user"></i> 
                                                    <h:outputText title="Responsável pelo lançamento" rendered="#{aSample.createdBy != null}" value="#{aSample.createdBy.fullName}" />
                                                    <h:outputText rendered="#{aSample.createdBy == null}" value="-" />

                                                    <i class="fa fa-calendar"></i> 
                                                    <h:outputText title="Data do lançamento" rendered="#{aSample.lastModified != null}" value="#{aSample.lastModified}" >
                                                        <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                                    </h:outputText>

                                                    <h:outputText rendered="#{aSample.lastModified == null}" value="-" >
                                                    </h:outputText>
                                                </div>

                                                <div class="timeline-header">
                                                    <span title="(%) Desfolha" class="label label-primary" style="line-height: inherit">#{aSample.defoliation}%</span>
                                                    <span title="Estádio da cultura" class="label label-primary" style="line-height: inherit">#{aSample.growthPhase.description}</span>

                                                </div>

                                                <div class="timeline-body">

                                                    <p:tabView>
                                                        <p:tab title="Pragas">

                                                            <p:dataTable var="aPestSample" value="#{aSample.mipSamplePestOccurrence}">
                                                                <p:column>
                                                                    <span>#{aPestSample.pestUsualName}</span>
                                                                    <span class="badge bg-blue">#{aPestSample.pestSizeName}</span>
                                                                </p:column>

                                                                <p:column>
                                                                    <h:outputText value="#{aPestSample.value}" >
                                                                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2" locale="pt_BR"></f:convertNumber>
                                                                    </h:outputText>
                                                                </p:column>

                                                            </p:dataTable>

                                                        </p:tab>

                                                        <p:tab title="Doenças">

                                                            <p:dataTable var="aPestDiseaseSample" value="#{aSample.mipSamplePestDiseaseOccurrence}">
                                                                <p:column>
                                                                    <span>#{aPestDiseaseSample.pestDiseaseUsualName}</span>
                                                                </p:column>

                                                                <p:column>
                                                                    <h:outputText value="#{aPestDiseaseSample.value}" >
                                                                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2" locale="pt_BR"></f:convertNumber>
                                                                    </h:outputText>
                                                                </p:column>
                                                            </p:dataTable>                                            

                                                        </p:tab>

                                                        <p:tab title="Inimigos Naturais">

                                                            <p:dataTable var="aNaturalPredatorSample" value="#{aSample.mipSampleNaturalPredatorOccurrence}">
                                                                <p:column>
                                                                    <span>#{aNaturalPredatorSample.pestNaturalPredatorUsualName}</span>
                                                                </p:column>

                                                                <p:column>
                                                                    <h:outputText value="#{aNaturalPredatorSample.value}" >
                                                                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2" locale="pt_BR"></f:convertNumber>
                                                                    </h:outputText>
                                                                </p:column>
                                                            </p:dataTable>                                                      

                                                        </p:tab>

                                                    </p:tabView>

                                                </div>

                                                <div class="timeline-footer">
                                                    <p:commandButton ajax="false" styleClass="btn-warning btn-xs" icon="fa fa-fw fa-pencil" ></p:commandButton>
                                                    <p:commandButton ajax="false" styleClass="btn-danger btn-xs" icon="fa fa-fw fa-trash" ></p:commandButton>
                                                </div>

                                            </div>
                                        </li>
                                    </p:repeat>

                                    <li>
                                        <i class="fa fa-fw fa-clock-o bg-gray"></i>
                                    </li>
                                </ul>

                                <p:spacer height="5px"/>

                            </p:scrollPanel>

                            <p:spacer height="5px"/>
                        </div>

                        <div class="col-md-8 col-sm-12">
                            <p:tabView>
                                <p:tab title="Lagartas">
                                    <hf:chart type="line" value="#{urDashboardController.caterpillarFluctuationChart}" var="daeOccurrences" point="#{daeOccurrences.occurrence}" tickLabel="#{daeOccurrences.dae}" xaxisLabel="Dias Após Emergência" yaxisLabel="No. Insetos/Metro" ></hf:chart>
                                </p:tab>

                                <p:tab title="Percevejos">
                                    <hf:chart type="line" value="#{urDashboardController.bedBugFluctuationChart}" var="daeOccurrences" point="#{daeOccurrences.occurrence}" tickLabel="#{daeOccurrences.dae}" xaxisLabel="Dias Após Emergência" yaxisLabel="No. Insetos/Metro" ></hf:chart>
                                </p:tab>

                                <p:tab title="Inimigos Naturais">
                                    <hf:chart type="line" value="#{urDashboardController.naturalPredatorFluctuationChart}" var="daeOccurrences" point="#{daeOccurrences.occurrence}" tickLabel="#{daeOccurrences.dae}" xaxisLabel="Dias Após Emergência" yaxisLabel="No. Insetos/Metro" ></hf:chart>
                                </p:tab>

                                <p:tab title="Desfolha">
                                    <hf:chart type="line" value="#{urDashboardController.defoliationFluctuationChart}" var="daeOccurrences" point="#{daeOccurrences.occurrence}" tickLabel="#{daeOccurrences.dae}" xaxisLabel="Dias Após Emergência" yaxisLabel="(%) de Desfolha" ></hf:chart>
                                </p:tab>
                            </p:tabView>
                        </div>

                    </p:panel>
                </div>
            </div>

            <p:spacer height="15px"/>

            <div class="row" >
                <div class="col-md-12">
                    <p:panel header="Manejo Integrado de Doenças" styleClass="box-primary" toggleable="true" closable="true">
                        <div class="col-md-5 col-sm-12">
                            <p:scrollPanel style="height:500px">

                                <p:spacer height="5px"/>

                                <ul class="timeline">

                                    <p:repeat value="#{urDashboardController.MIDRustSampleData}" var="aSample">
                                        <li class="time-label">
                                            <span class="bg-blue">
                                                <h:outputText title="Data da amostra" value="#{aSample.sampleDate}" >
                                                    <f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
                                                </h:outputText>
                                            </span>
                                        </li>

                                        <li>
                                            <i class="fa fa-fw bg-gray">

                                            </i>
                                            <div class="timeline-item">


                                                <div class="time">
                                                    <i class="fa fa-user"></i> 
                                                    <h:outputText title="Responsável pelo lançamento" rendered="#{aSample.createdBy != null}" value="#{aSample.createdBy.fullName}" />
                                                    <h:outputText rendered="#{aSample.createdBy == null}" value="-" />

                                                    <i class="fa fa-calendar"></i> 
                                                    <h:outputText title="Data do lançamento" rendered="#{aSample.lastModified != null}" value="#{aSample.lastModified}" >
                                                        <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                                    </h:outputText>

                                                    <h:outputText rendered="#{aSample.lastModified == null}" value="-" >
                                                    </h:outputText>
                                                </div>

                                                <div class="timeline-header">

                                                </div>

                                                <div class="timeline-body">

                                                    <p:tabView>
                                                        
                                                        <p:tab title="Inspeção Foliar">
                                                            <p:panelGrid columns="2">
                                                                <h:outputText value="Estádio das Plantas"></h:outputText>
                                                                <h:outputText value="#{aSample.leafInspectionOccurrence.growthPhase.description}" />
                                                                
                                                                <h:outputText value="Resultado da Inspeção Foliar para Ferrugem Asiática"></h:outputText>
                                                                <h:outputText value="#{aSample.leafInspectionOccurrence.bladeReadingRustResultLeafInspection.description}" />
                                                            </p:panelGrid>
                                                        </p:tab>
                                                        
                                                        <p:tab title="Coletor de Esporos">
                                                            <p:panelGrid columns="2">
                                                                <h:outputText value="Lâmina Colocada na Véspera da Frente Fria"></h:outputText>
                                                                <h:outputText value="#{aSample.sporeCollectorOccurrence.bladeInstalledPreCold ? 'Sim' : 'Não'}" />
                                                                
                                                                <h:outputText value="Profissional Responsável pela Leitura da Lâmina"></h:outputText>
                                                                <h:outputText value="#{aSample.sporeCollectorOccurrence.bladeReadingResponsiblePerson.name}" />
                                                                
                                                                <h:outputText value="Entidade do Responsável pela Leitura"></h:outputText>
                                                                <h:outputText value="#{aSample.sporeCollectorOccurrence.bladeReadingResponsiblePerson.entityName}" />

                                                                <h:outputText value="Data de Leitura da Lâmina"></h:outputText>
                                                                <h:outputText value="#{aSample.sporeCollectorOccurrence.bladeReadingDate}" >
                                                                    <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                                                </h:outputText>
                                                                
                                                                <h:outputText value="Resultado da Leitura da Lâmina para Uredosporos da Ferrugem Asiática"></h:outputText>
                                                                <h:outputText value="#{aSample.sporeCollectorOccurrence.bladeReadingRustResultCollector.description}" />
                                                                
                                                            </p:panelGrid>
                                                        </p:tab>

                                                    </p:tabView>

                                                </div>

                                                <div class="timeline-footer">
                                                    <p:commandButton ajax="false" styleClass="btn-warning btn-xs" icon="fa fa-fw fa-pencil" ></p:commandButton>
                                                    <p:commandButton ajax="false" styleClass="btn-danger btn-xs" icon="fa fa-fw fa-trash" ></p:commandButton>
                                                </div>

                                            </div>
                                        </li>
                                    </p:repeat>

                                    <li>
                                        <i class="fa fa-fw fa-clock-o bg-gray"></i>
                                    </li>
                                </ul>

                                <p:spacer height="5px"/>

                            </p:scrollPanel>

                            <p:spacer height="5px"/>
                        </div>

                    </p:panel>
                </div>
            </div>

            <!--            <div class="row" >
                            <div class="col-md-12">
                                <p:panel header="Box Colors" styleClass="box-primary" toggleable="true" closable="true">
            
                                    <f:facet name="actions">
                                        <h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"><h:outputText
                                                styleClass="ui-icon ui-icon-help"/></h:commandLink>
                                        <h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default"><h:outputText
                                                styleClass="ui-icon ui-icon-star"/></h:commandLink>
                                    </f:facet>
            
                                    <div class="col-md-3">
                                        <p:pieChart model="#{urDashboardController.getPieChart()}" style="width: 100%; height: 300px;"/>
                                    </div>
            
                                    <div class="col-md-7">
                                        <p:lineChart model="#{urDashboardController.getLineChart()}" style="width: 100%; height: 300px;"/>
                                    </div>
            
                                </p:panel>
                            </div>
                        </div>-->

            <p:spacer height="15px"/>




            <p:spacer height="15px"/>


        </h:form>
    </ui:define>
</ui:composition>